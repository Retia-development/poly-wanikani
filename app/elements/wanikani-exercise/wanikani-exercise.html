<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="wanikani-exercise">
  <template>
    <style>
      :host {
        display: block;
      }

      :host[type="kanji"] {
        background-color: var(--kanji-color);
      }

      :host[type="radical"] {
        background-color: var(--radical-color);
      }

      :host[type="vocabulary"] {
        background-color: var(--vocabulary-color)
      }

      #answerForm {
        width: 100%;
        background-color: var(--default-primary-color);
        position: absolute;
        bottom: 0;
        padding: 25px;
      }

      input {
        color: white;
        border: none;
        background: transparent;
        font: inherit;
        font-size: 32px;
        outline: none;
      }

      img {
        display: block;
        margin: 0 auto;
      }
    </style>
    <wani-kani-symbol symbol="[[item.character]]" hidden$="{{hasImage}}"></wani-kani-symbol>
    <img src="[[item.image]]" hidden$="{{!hasImage}}" alt="">

    <paper-material class="flex" elevation="3" id="answerForm">
      <form is="iron-form" id="form" class="flex">
        <input type="text" class="flex" placeholder="meaning" name="meaning" required autofocus/>
      </form>
    </paper-material>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'wanikani-exercise',
      listeners: {
        'iron-form-submit': '_validateAnswer'
      },
      properties: {
        item: Object,
        type: {
          type: String,
          reflectToAttribute: true,
          computed: 'getType(item)'
        },
        hasImage: {
          type: Boolean,
          computed: '_hasImage(item)'
        }
      },
      getType: function(item) {
        return item.type;
      },
      _hasImage: function(item) {
        return !_.isUndefined(item.image);
      },
      _validateAnswer: function(e, data) {
        var answer = data.meaning;
        if (answer.toLowerCase() === this.item.meaning.toLowerCase()) {
          this.fire('correct-answer');
        } else {
          this.fire('wrong-answer', this.item.meaning);
        }
      },
      isType: function(item, type) {
        console.log(arguments);
        return item.type === type;
      }
    });
  })();
  </script>
</dom-module>
